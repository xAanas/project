{% extends '::base.html.twig' %}
{% block title %}Demandes{% endblock %}
{% block body -%}
    <div class="container">
        <h1>Demandes</h1>
         <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">x</button>
                        <h4 class="modal-title">Nouvelle demande :</h4>
                    </div>
                    <div class="modal-body">
                        <div class="well">
                            
                        {{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}

                        {# Les erreurs générales du formulaire. #}
                        {{ form_errors(form) }}

                        <div class="form-group">
                            {{ form_label(form.auNomDe, "Demande au nom de : ", {'label_attr': {'class': 'col-sm-3  control-label'}}) }}

                            {{ form_errors(form.auNomDe) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.auNomDe, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.sites, "Site : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.sites) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.sites, {'attr': {'class': 'form-control'}}) }}
                            </div>
                            <div class="col-sm-4">
                                    <a href="#" data-toggle="modal" data-target="#myModalSite"><div style="font-size:15px ; color: black;">autres site...</div></a>
                                </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.missionOne, "Mission 1 : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.missionOne) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.missionOne, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.missionTwo, "Mission 2 : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.missionTwo) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.missionTwo, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.missionThree, "Mission 3 : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.missionThree) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.missionThree, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.autres, "Autres : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.autres) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.autres, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.detailsMissionOne, "Détails mission 1 : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.detailsMissionOne) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.detailsMissionOne, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.detailsMissionTwo, "Détails mission 2 : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.detailsMissionTwo) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.detailsMissionTwo, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.detailsMissionThree, "Détails mission 3 : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.detailsMissionThree) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.detailsMissionThree, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.dateLimite, "Date limite : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.dateLimite) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.dateLimite, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.lien, "Liens : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.lien) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.lien, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.niveauUrgence, "Niveau d\'urgence : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.niveauUrgence) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.niveauUrgence, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.etat, "Etat : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.etat) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.etat, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.confidentialite, "Confidentialité : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.confidentialite) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.confidentialite, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.docGdl, "DocGDL : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.docGdl) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.docGdl, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.envoiePrevuLe, "Envoie prévu le : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.envoiePrevuLe) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.envoiePrevuLe, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form_label(form.mettreEnCopie, "Mettre en copie : ", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}

                            {{ form_errors(form.mettreEnCopie) }}

                            <div class="col-sm-4">
                                {{ form_widget(form.mettreEnCopie, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                            <div class="form-group" align="middle">
                                <input type="reset" value="Annuler" class="btn btn-default">
                                <input type="submit" value="Créer" class="btn btn-info">
                        </div>
                        {{ form_rest(form) }}

                        {# Fermeture de la balise <form> du formulaire HTML #}
                        {{ form_end(form) }}
                    
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default" data-dismiss="modal">Quitter</button>
                    </div>
                </div>
            </div>
        </div>
                        <div class="modal fade" id="myModalSite" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">x</button>
                        <h4 class="modal-title">Nouveau site :</h4>
                    </div>
                    <div class="modal-body">
                        <div class="well">
                           {{ form_start(formsite, {'attr': {'class': 'form-horizontal'}}) }}
                        {{ form_errors(formsite) }}
                        <div class="form-group">
                            {{ form_label(formsite.nom, "Nom : ", {'label_attr': {'class': 'col-sm-3  control-label'}}) }}

                            {{ form_errors(formsite.nom) }}

                            <div class="col-sm-4">
                                {{ form_widget(formsite.nom, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                            <div class="form-group">
                            {{ form_label(formsite.adresse, "Adresse : ", {'label_attr': {'class': 'col-sm-3  control-label'}}) }}

                            {{ form_errors(formsite.adresse) }}

                            <div class="col-sm-4">
                                {{ form_widget(formsite.adresse, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                            <div class="form-group">
                            {{ form_label(formsite.description, "Description : ", {'label_attr': {'class': 'col-sm-3  control-label'}}) }}

                            {{ form_errors(formsite.description) }}

                            <div class="col-sm-4">
                                {{ form_widget(formsite.description, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                            <div class="form-group">
                            {{ form_label(formsite.clients, "Client : ", {'label_attr': {'class': 'col-sm-3  control-label'}}) }}

                            {{ form_errors(formsite.clients) }}

                            <div class="col-sm-4">
                                {{ form_widget(formsite.clients, {'attr': {'class': 'form-control'}}) }}
                            </div>
                        </div>
                            <div class="form-group" align="middle">
                                <input type="reset" value="Annuler" class="btn btn-default">
                                <input type="submit" value="Créer" class="btn btn-info">
                        </div>
                            {{ form_rest(formsite) }}

                        {# Fermeture de la balise <form> du formulaire HTML #}
                        {{ form_end(formsite) }}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default" data-dismiss="modal">Quitter</button>
                    </div>
                </div>
            </div>
        </div>
        <div align="right">
            <a href="#" data-toggle="modal" data-target="#myModal" class="btn btn-default"><span class="glyphicon glyphicon-plus-sign"></span> Créer une nouvelle demande</a>
        </div>
        <br/>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Expéditeur</th>
                    <th>Au nom de</th>
                    <th>Client</th>
                    <th>Site</th>
                    <th>Date limite</th>
                    
                    <th>Niveau d'urgence</th>
                    <th>Etat</th>
                    <th>Date du post</th>
                    <th>Accueil</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for entity in entities|reverse %}
                    <tr>
                        <td><a href="{{ path('demandes_show', { 'id': entity.id }) }}">{{ entity.id }}</a></td>
                        <td>{{ entity.utilisateur }}</td>
                        <td>{{ entity.auNomDe }}</td>
                        <td>{{ entity.sites.clients }}</td>
                        <td>{{ entity.sites }}</td>
                        <td>{% if entity.dateLimite %}{{ entity.dateLimite|date('Y-m-d H:i:s') }}{% endif %}</td>
                        
                        {#<td>{% for fichier in entity.fichiers %}    
                            {{loop.length}}
                        {% endfor %} fichiers</td>#}
                    <td>{{ entity.niveauUrgence }}</td>
                    <td>{{ entity.etat }}</td>
                    <td>{% if entity.datePosteDemande %}{{ entity.datePosteDemande|date('Y-m-d H:i:s') }}{% endif %}</td>
                    <td>{{ entity.accueil }}</td>
                    <td>
                        
                                <a href="{{ path('demandes_show', { 'id': entity.id }) }}"><span class="glyphicon glyphicon-file" title="voir la demande"></span></a>
                           
                                <a href="{{ path('demandes_edit', { 'id': entity.id }) }}"><span class="glyphicon glyphicon-pencil" title="modifier la demande"></span></a>
                                
                                <a id="exportDemande{{ entity.id}}" onclick="exporterDemande('{{ entity.id}}')"> <span class="glyphicon glyphicon-download-alt" title="télécharger la demande"></span></a>
                          
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>

            
        </div>
        {% endblock %}
