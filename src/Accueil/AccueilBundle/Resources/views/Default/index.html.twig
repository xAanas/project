{% extends '::base.html.twig' %}
{% block title %}Accueil{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{asset('css/style.css')}}" />
{% endblock %}
{% block body %}
    <div class="container">
        <div class="row">

            <div class="col-md-9 col-xs-12">
                {% for demande in demandes|reverse|slice(0, 11) if demande.accueil %}
                    <div class="panel panel-danger">
                        <button type="button" class="close"><div style="font-size:15px ;">x</div></button>
                        <!-- Default panel contents -->
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-md-3">
                                    <div style="font-size:20px ;"><a href="{{ path('demandes_show_comments', { 'id': demande.id }) }}" style="color:#a94442">Demande : 00{{demande.id}}</a></div><br/>
                                    {% if demande.type == 'urgente'%}
                                        <div style="font-size:25px ;">{{demande.type}}</div>
                                    {% endif %}

                                </div>
                                <div class="col-md-3">
                                    <div style="font-size:20px ;">Client : {{demande.client}}</div>
                                </div>
                                <div class="col-md-2">
                                    <div style="font-size:18px ;"><a href="#" data-toggle="modal" data-target="#avancementModal{{ demande.id }}" style="color:#a94442"><pan id="avancementchamp{{ demande.id }}">Etat : {{demande.avancement}}  </a></div> <br/>    
                                    <div class="progress" id="progress{{ demande.id }}">
                                        {% if demande.avancement == 'Emise' %}
                                            <div class="progress-bar progress-bar-warning" style="width: 100%" id="progresscouleur{{demande.id}}">
                                                <span class="sr-only-focusable" id="progressmot{{demande.id}}">Emise</span>
                                            </div>
                                        {% elseif demande.avancement == 'En cour'%}
                                            <div class="progress-bar progress-bar-success" style="width: 60%" id="progresscouleur{{demande.id}}">
                                                <span class="sr-only-focusable"  id="progressmot{{demande.id}}">60% Complete </span>
                                            </div>
                                        {% elseif demande.avancement == 'Annulée'%}
                                            <div class="progress-bar progress-bar-danger" style="width: 100%" id="progresscouleur{{demande.id}}">
                                                <span class="sr-only-focusable" id="progressmot{{demande.id}}">Annulée</span>
                                            </div>
                                        {% else %}
                                            <div class="progress-bar progress-bar-info" style="width: 100%" id="progresscouleur{{demande.id}}">
                                                <span class="sr-only-focusable" id="progressmot{{demande.id}}">Livrée</span>
                                            </div>
                                        {% endif %}
                                    </div>

                                </div>
                                <div class="col-md-2">
                                    <div style="font-size:18px ;">{{demande.dateLimite|date("d/m/Y")}}  </div>
                                </div>
                                <div class="col-md-1">
                                    <div style="font-size:15px ;"><div align="right"> 25 <span class="glyphicon glyphicon-comment"></span><br/>
                                            5 <span class="glyphicon glyphicon-file"></span>  </div></div>
                                </div>
                                <div class="col-md-1">
                                    <div style="font-size:15px ;"><div align="left"> <span id="siaime{{demande.id}}"> {{demande.jaime}} </span> <span class="glyphicon glyphicon-heart"></span><br/>
                                            <span id="pasaime{{demande.id}}"> {{demande.jeNaimePas}} </span> <span class="glyphicon glyphicon-heart-empty"></span>  </div></div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-2">
                                    {{demande.utilisateur}}
                                </div>
                                <div class="col-md-10">
                                    <ul class="list-group">
                                        <li class="list-group-item">
                                            <span class="badge">1</span>
                                            {{demande.missionOne}}
                                        </li>
                                        <li class="list-group-item">
                                            <span class="badge">3</span>
                                            {{demande.missionTwo}}
                                        </li>
                                        <li class="list-group-item">
                                            <span class="badge">2</span>
                                            {{demande.missionThree}}
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12 col-xs-12">
                                    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                                        <div class="panel panel-default">
                                            <div class="panel-heading" role="tab" id="headingOne">
                                                <h4 class="panel-title">
                                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne{{demande.id}}" aria-expanded="true" aria-controls="collapseOne" class="">
                                                        Détails   <span class="caret"></span>                                          
                                                    </a>
                                                </h4>
                                            </div>
                                            <div id="collapseOne{{demande.id}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne" aria-expanded="false">
                                                <div class="panel-body">
                                                    {{demande.autres}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <a href="javascript:aimerscript('{{demande.id}}',document.getElementById('siaime{{demande.id}}'));">j'aime</a> .
                                    <a href="javascript:neaimerscript('{{demande.id}}',document.getElementById('pasaime{{demande.id}}'));">je n'aime pas</a>
                                    <span id="loader{{demande.id}}" style="display: none;"><img src="{{ asset('img/loader.gif') }}" alt="loading" /></span>
                                </div>
                                <div class="col-md-6">
                                    <div align="right">{{demande.datePosteDemande|date}}  </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <ul class="list-group" id="commentaires{{ demande.id}}">
                        <li class="list-group-item" style="display : none" id="ajoutcomm{{ demande.id}}">

                        </li>
                        {% for comment in comments|reverse|slice(0,2) %}
                            {% if comment.demande.id == demande.id %}
                                <li class="list-group-item">
                                    {{comment.utilisateur}} : {{ comment.contenu}}<br/>
                                    {% for image in comment.fichier %}
                                        <img src="{{asset('uploads/'~image.lien)}}" width="350" height="350">
                                        <a href="{{asset('uploads/'~image.lien)}}">Fichier !</a>

                                    {% endfor %}
                                    <div align="right">
                                        {{comment.dateCommentaire|date}}
                                    </div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                    <br/>
                    <form method="post" enctype="multipart/form-data">
                        <div class="input-group">
                            <input type="text" class="form-control" id="commentaire{{demande.id}}" placeholder="Ecrire un commentaire...">
                            <span class="input-group-btn">
                                <a href="javascript:commenterscript('{{demande.id}}', document.getElementById('commentaire{{demande.id}}'));" class="btn btn-default">commenter</a>
                                <span id="loaderCom{{demande.id}}" style="display: none;"><img src="{{ asset('img/loader.gif') }}" alt="loading" /></span>
                            </span>

                        </div>

                    </form> 
                    <br/><br/><br/><br/><br/><br/><br/><br/><br/>   
                    <div class="modal fade" id="avancementModal{{ demande.id }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">x</button>
                                    <h4 class="modal-title">Définis l'état d'avancement de la demande</h4>
                                </div>
                                <div class="modal-body">

                                    <ul class="list-group">
                                        <li class="list-group-item"><a href="javascript:modifetat('{{demande.id}}', 'Emise',document.getElementById('avancementchamp{{demande.id}}'));">Emise</a></li>
                                        <li class="list-group-item"><a href="javascript:modifetat('{{demande.id}}', 'En cour',document.getElementById('avancementchamp{{demande.id}}'));">En cour</a></li>
                                        <li class="list-group-item"><a href="javascript:modifetat('{{demande.id}}', 'Annulée',document.getElementById('avancementchamp{{demande.id}}'));">Annulée</a></li>
                                        <li class="list-group-item"><a href="javascript:modifetat('{{demande.id}}', 'Livrée',document.getElementById('avancementchamp{{demande.id}}'));">Livrée</a></li>
                                    </ul>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-info" data-dismiss="modal">Quitter</button><span id="loaderetat{{demande.id}}" style="display: none;"><img src="{{ asset('img/loader.gif') }}" alt="loading" /></span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            Hello {{ app.user.username }} ! i thnik you will be very nicceeee. Some default panel content here. Nulla vitae elit libero, 
            a pharetra augue. Aenean lacinia bibendum nulla sed consectetur. 
            Aenean eu leo quam. Pellentesque ornare sem lacinia quam venenatis vestibulum. 
            Nullam id dolor id nibh ultricies vehicula ut id elit.

        </div>

    </div>
    <!--   *****************************  MOODAL  **********************************  -->

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">x</button>
                    <h4 class="modal-title">Nouvelle demande :</h4>
                </div>
                <div class="modal-body">
                    {{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}
                    {{ form_errors(form) }}

                    <table class="table table-striped">
                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.auNomDe, "Au nom de ", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }} 
                            </td>
                            <td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.auNomDe) }}

                                <div class="col-lg-5 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.auNomDe, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr>
                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.client, "Client ", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }} 
                            </td>
                            <td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.client) }}

                                <div class="col-lg-5 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.client, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr>


                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.site, "Site ", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.site) }}

                                <div class="col-lg-5 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.site, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr>

                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.adresse, "Adresse ", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.adresse) }}

                                <div class="col-lg-5 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.adresse, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr>

                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.missionOne, "Mission 1 ", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.missionOne) }}

                                <div class="col-lg-6 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.missionOne, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr>
                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.missionTwo, "Mission 2 ", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.missionTwo) }}

                                <div class="col-lg-6 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.missionTwo, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr>
                        <tr>
                            <td>                        {# Génération du label. #}
                                {{ form_label(form.missionThree, "Mission 3 ", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.missionThree) }}

                                <div class="col-lg-6 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.missionThree, {'attr': {'class': 'form-control'}}) }}
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>  
                                {# Génération du label. #}
                                {{ form_label(form.autres, "Autres ", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.autres) }}

                                <div class="col-lg-5 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.autres, {'attr': {'class': 'form-control'}}) }}
                                </div> </td>
                        </tr>
                        <tr>
                            <td width="50%">  
                                {# Génération du label. #}
                                {{ form_label(form.detailsMissionOne, "Detais mission 1 ", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.detailsMissionOne) }}

                                <div class="col-lg-5 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.detailsMissionOne, {'attr': {'class': 'form-control'}}) }}
                                </div>
                            </td>
                        </tr>          
                        <tr>
                            <td>           
                                {# Génération du label. #}
                                {{ form_label(form.detailsMissionTwo, "Detais mission 2", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.detailsMissionTwo) }}

                                <div class="col-lg-5 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.detailsMissionTwo, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr> 
                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.detailsMissionThree, "Detais mission 3", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.detailsMissionThree) }}

                                <div class="col-lg-5 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.detailsMissionThree, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr> 
                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.dateLimite, "Délais du rendu", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.dateLimite) }}

                                <div class="col-lg-6 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.dateLimite, {'attr': {'class': 'date'}}) }}
                                </div></td>
                        </tr> 
                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.lien, "Dossier à disposition", {'label_attr': {'class': 'col-lg-6 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.lien) }}

                                <div class="col-lg-5 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.lien, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr> 
                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.type, "Type", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.type) }}

                                <div class="col-lg-6 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.type, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr> 
                        <tr>
                            <td>
                                {# Génération du label. #}
                                {{ form_label(form.avancement, "Avancement", {'label_attr': {'class': 'col-lg-5 col-sm-3 control-label'}}) }}
                            </td><td>
                                {# Affichage des erreurs pour ce champ précis. #}
                                {{ form_errors(form.avancement) }}

                                <div class="col-lg-6 col-sm-4">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.avancement, {'attr': {'class': 'form-control'}}) }}
                                </div></td>
                        </tr> 

                        <tr>
                            <td></td>
                            <td> 
                                <div class="col-lg-6 col-sm-3">
                                    <input type="submit" class="btn btn-primary" value="Enregistrer" formnovalidate>
                                    <input type="reset" class="btn btn-default" value="Annuler">
                                </div>
                            </td>
                        </tr>




                        <!-- ****************************************************************************************************************************************** -->
                        <ul id="fichiers-fields-list" class="fichiers list-group" data-prototype="{{ form_widget(form.fichiers.vars.prototype)|e }}">
                            {# itère sur chaque tag existant et affiche son unique champ : name #}
                            {% for fichier in form.fichiers %}
                                <li class="list-group-item">{{ form_row(fichier.file) }}</li>
                                {% endfor %}
                        </ul>
                        {{ form_rest(form) }}


                        {{ form_end(form) }}
                    </table>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-info" data-dismiss="modal">Quitter</button>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        var collectionHolder = $('ul.fichiers');

        // ajoute un lien « add a tag »
        var $addFichierLink = $('<a href="#" class="add_tag_link">Ajouter un fichier</a>');
        var $newLinkLi = $('<li class="list-group-item"></li>').append($addFichierLink);

        jQuery(document).ready(function () {
            // ajoute l'ancre « ajouter un tag » et li à la balise ul
            collectionHolder.append($newLinkLi);

            $addFichierLink.on('click', function (e) {
                // empêche le lien de créer un « # » dans l'URL
                e.preventDefault();

                // ajoute un nouveau formulaire tag (voir le prochain bloc de code)
                addFichierForm(collectionHolder, $newLinkLi);
            });
        });

        function addFichierForm(collectionHolder, $newLinkLi) {
            // Récupère l'élément ayant l'attribut data-prototype comme expliqué plus tôt
            var prototype = collectionHolder.attr('data-prototype');

            // Remplace '__name__' dans le HTML du prototype par un nombre basé sur
            // la longueur de la collection courante
            var newForm = prototype.replace(/__name__/g, collectionHolder.children().length);

            // Affiche le formulaire dans la page dans un li, avant le lien "ajouter un tag"
            var $newFormLi = $('<li class="list-group-item"></li>').append(newForm);
            $newLinkLi.before($newFormLi);
        }
    </script>


{% endblock %}
